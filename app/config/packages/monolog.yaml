monolog:
    channels:
        - deprecation   # Deprecations are logged in the dedicated "deprecation" channel when it exists
        - auth          # Authentification CFI (CfiAuthenticator, UserAuthenticationService)
        - chat          # Chat IA uniquement (ChatService, Tools IA)
        - streaming     # Streaming Mercure SSE (ChatStreamPublisher)
        - cfi_api       # Appels API CFI (CfiApiService, CfiTenantService, CfiSessionService)
        - messenger     # Messages async Symfony Messenger
        - api_services  # Services API métier (FacturationApiService, OperationApiService, StockApiService, etc.)
        - tools         # Tools IA (GetFacturesTool, GetOperationsTool, GetStocksTool, etc.)
        - permissions   # Gestion des droits utilisateurs (PermissionsApiService, vérifications d'accès)
        - llm           # Appels LLM (Mistral via Symfony AI Bundle - temps génération, tokens, coût)
        # Canaux marketing (8 assets + 4 agents + 3 stores + 3 tools + 2 services)
        - marketing.asset.google_ads
        - marketing.asset.bing_ads
        - marketing.asset.linkedin_post
        - marketing.asset.facebook_post
        - marketing.asset.instagram_post
        - marketing.asset.mail
        - marketing.asset.iab
        - marketing.asset.article
        - marketing.agent.persona
        - marketing.agent.strategy
        - marketing.agent.competitor
        - marketing.agent.content
        - marketing.agent.project_enrichment
        - marketing.store.persona
        - marketing.store.competitor
        - marketing.store.brand
        - marketing.tool.budget
        - marketing.tool.competitor_intel
        - marketing.tool.brand_style
        - marketing.tool.project_context
        - marketing.prompt_builder
        - marketing.general
        - marketing.task          # Task Persistence (async tasks tracking)

when@dev:
    monolog:
        handlers:
            # Fichier principal (tous les logs sauf channels spécifiques)
            main:
                type: rotating_file
                path: "%kernel.logs_dir%/%kernel.environment%.log"
                level: debug
                max_files: 7
                channels: ["!event", "!auth", "!chat", "!streaming", "!cfi_api", "!messenger", "!api_services", "!tools", "!permissions", "!llm", "!marketing.asset.google_ads", "!marketing.asset.bing_ads", "!marketing.asset.linkedin_post", "!marketing.asset.facebook_post", "!marketing.asset.instagram_post", "!marketing.asset.mail", "!marketing.asset.iab", "!marketing.asset.article", "!marketing.agent.persona", "!marketing.agent.strategy", "!marketing.agent.competitor", "!marketing.agent.content", "!marketing.agent.project_enrichment", "!marketing.store.persona", "!marketing.store.competitor", "!marketing.store.brand", "!marketing.tool.budget", "!marketing.tool.competitor_intel", "!marketing.tool.brand_style", "!marketing.tool.project_context", "!marketing.prompt_builder", "!marketing.general", "!marketing.task"]

            # Logs d'authentification CFI
            auth:
                type: rotating_file
                path: "%kernel.logs_dir%/auth.log"
                level: info
                max_files: 14
                channels: ["auth"]

            # Logs du chat IA (ChatService, Tools uniquement)
            chat:
                type: rotating_file
                path: "%kernel.logs_dir%/chat.log"
                level: debug
                max_files: 7
                channels: ["chat"]

            # Logs du streaming Mercure (ChatStreamPublisher)
            streaming:
                type: rotating_file
                path: "%kernel.logs_dir%/streaming.log"
                level: info  # INFO uniquement (pas DEBUG = pas de chunks)
                max_files: 7
                channels: ["streaming"]

            # Logs des appels API CFI
            cfi_api:
                type: rotating_file
                path: "%kernel.logs_dir%/cfi_api.log"
                level: debug
                max_files: 7
                channels: ["cfi_api"]

            # Logs Messenger (messages async)
            messenger:
                type: rotating_file
                path: "%kernel.logs_dir%/messenger.log"
                level: info
                max_files: 7
                channels: ["messenger"]

            # Logs des services API métier (FacturationApiService, OperationApiService, StockApiService, etc.)
            api_services:
                type: rotating_file
                path: "%kernel.logs_dir%/api_services.log"
                level: info
                max_files: 7
                channels: ["api_services"]

            # Logs des tools IA (GetFacturesTool, GetOperationsTool, GetStocksTool, etc.)
            tools:
                type: rotating_file
                path: "%kernel.logs_dir%/tools.log"
                level: info
                max_files: 7
                channels: ["tools"]

            # Logs de gestion des droits utilisateurs (PermissionsApiService, vérifications d'accès)
            permissions:
                type: rotating_file
                path: "%kernel.logs_dir%/permissions.log"
                level: info
                max_files: 14
                channels: ["permissions"]

            # Logs des appels LLM (Mistral via Symfony AI Bundle)
            llm:
                type: rotating_file
                path: "%kernel.logs_dir%/llm.log"
                level: info
                max_files: 7
                channels: ["llm"]

            # === Marketing Bundle - Assets (8 handlers) ===
            marketing_asset_google_ads:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/google_ads.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.google_ads']

            marketing_asset_bing_ads:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/bing_ads.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.bing_ads']

            marketing_asset_linkedin_post:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/linkedin_post.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.linkedin_post']

            marketing_asset_facebook_post:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/facebook_post.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.facebook_post']

            marketing_asset_instagram_post:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/instagram_post.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.instagram_post']

            marketing_asset_mail:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/mail.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.mail']

            marketing_asset_iab:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/iab.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.iab']

            marketing_asset_article:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/assets/article.log'
                level: debug
                max_files: 7
                channels: ['marketing.asset.article']

            # === Marketing Bundle - Agents (4 handlers) ===
            marketing_agent_persona:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/agents/persona.log'
                level: debug
                max_files: 7
                channels: ['marketing.agent.persona']

            marketing_agent_strategy:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/agents/strategy.log'
                level: debug
                max_files: 7
                channels: ['marketing.agent.strategy']

            marketing_agent_competitor:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/agents/competitor.log'
                level: debug
                max_files: 7
                channels: ['marketing.agent.competitor']

            marketing_agent_content:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/agents/content.log'
                level: debug
                max_files: 7
                channels: ['marketing.agent.content']

            marketing_agent_project_enrichment:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/agents/project_enrichment.log'
                level: debug
                max_files: 7
                channels: ['marketing.agent.project_enrichment']

            # === Marketing Bundle - Stores (3 handlers) ===
            marketing_store_persona:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/stores/persona.log'
                level: debug
                max_files: 7
                channels: ['marketing.store.persona']

            marketing_store_competitor:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/stores/competitor.log'
                level: debug
                max_files: 7
                channels: ['marketing.store.competitor']

            marketing_store_brand:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/stores/brand.log'
                level: debug
                max_files: 7
                channels: ['marketing.store.brand']

            # === Marketing Bundle - Tools (3 handlers) ===
            marketing_tool_budget:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/tools/budget.log'
                level: debug
                max_files: 7
                channels: ['marketing.tool.budget']

            marketing_tool_competitor_intel:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/tools/competitor_intel.log'
                level: debug
                max_files: 7
                channels: ['marketing.tool.competitor_intel']

            marketing_tool_brand_style:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/tools/brand_style.log'
                level: debug
                max_files: 7
                channels: ['marketing.tool.brand_style']

            marketing_tool_project_context:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/tools/project_context.log'
                level: debug
                max_files: 7
                channels: ['marketing.tool.project_context']

            # === Marketing Bundle - Services (2 handlers) ===
            marketing_prompt_builder:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/prompt_builder.log'
                level: debug
                max_files: 7
                channels: ['marketing.prompt_builder']

            marketing_general:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/general.log'
                level: debug
                max_files: 7
                channels: ['marketing.general']

            # === Marketing Bundle - Task Persistence (Async Tasks) ===
            marketing_task:
                type: rotating_file
                path: '%kernel.logs_dir%/marketing/tasks/task_execution.log'
                level: debug
                max_files: 7
                channels: ['marketing.task']

            # uncomment to get logging in your browser
            # you may have to allow bigger header sizes in your Web server configuration
            #firephp:
            #    type: firephp
            #    level: info
            #chromephp:
            #    type: chromephp
            #    level: info
            console:
                type: console
                process_psr_3_messages: false
                channels: ["!event", "!doctrine", "!console"]

when@test:
    monolog:
        handlers:
            main:
                type: fingers_crossed
                action_level: error
                handler: nested
                excluded_http_codes: [404, 405]
                channels: ["!event"]
            nested:
                type: stream
                path: "%kernel.logs_dir%/%kernel.environment%.log"
                level: debug

when@prod:
    monolog:
        handlers:
            main:
                type: fingers_crossed
                action_level: error
                handler: nested
                excluded_http_codes: [404, 405]
                buffer_size: 50 # How many messages should be saved? Prevent memory leaks
            nested:
                type: stream
                path: php://stderr
                level: debug
                formatter: monolog.formatter.json
            console:
                type: console
                process_psr_3_messages: false
                channels: ["!event", "!doctrine"]
            deprecation:
                type: stream
                channels: [deprecation]
                path: php://stderr
                formatter: monolog.formatter.json
