# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    # API CFI Configuration
    cfi.api.base_url: '%env(CFI_API_BASE_URL)%'
    cfi.api.clef: '%env(CFI_API_CLEF)%'
    cfi.api.timeout: '%env(int:CFI_API_TIMEOUT)%'
    cfi.token.ttl: '%env(int:CFI_TOKEN_TTL)%'
    cfi.token.refresh_threshold: '%env(int:CFI_TOKEN_REFRESH_THRESHOLD)%'

    # Mercure Hub Configuration (Sprint S1+)
    # URL du hub Mercure pour le streaming temps réel
    # Défaut vide pour MVP Sprint S1 (mode sync uniquement)
    mercure.default_hub: '%env(default::MERCURE_PUBLIC_URL)%'

    # Feature Flags - Authentification
    # Activer le mode d'authentification email/password (false en attendant endpoint CFI)
    cfi.auth.credentials_enabled: false

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones

    # CFI API Service Configuration
    App\Service\Cfi\CfiApiService:
        arguments:
            $cfiApiBaseUrl: '%cfi.api.base_url%'
            $cfiApiTimeout: '%cfi.api.timeout%'

    App\Service\Cfi\CfiAuthService:
        arguments:
            $clefApi: '%cfi.api.clef%'

    App\Service\Cfi\CfiSessionService:
        arguments:
            $tokenTtl: '%cfi.token.ttl%'
            $tokenRefreshThreshold: '%cfi.token.refresh_threshold%'
