{% extends 'layouts/home.html.twig' %}

{% block title %}Générer Personas - {{ project.name }}{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px;">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{{ path('marketing_project_index') }}">Projets Marketing</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{{ path('marketing_project_show', {id: project.id}) }}">{{ project.name }}</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Génération personas</li>
            </ol>
        </nav>

        <h1 class="h3 mb-1">Générer les personas clients</h1>
        <p class="text-muted">Étape 2 sur 4 : L'IA va analyser votre secteur et créer des personas détaillés</p>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <div class="d-flex align-items-center">
                <i class="bi bi-robot fs-4 me-2"></i>
                <div>
                    <h5 class="mb-0">Génération IA avec Mistral Large</h5>
                    <small>Temps estimé : 30-60 secondes par persona</small>
                </div>
            </div>
        </div>
        <div class="card-body p-4">
            {{ form_start(form) }}

            {{ form_row(form.numberOfPersonas, {
                label: 'Nombre de personas à générer',
                attr: {
                    class: 'form-range',
                    min: '1',
                    max: '5'
                }
            }) }}

            <div class="text-center mb-4">
                <span class="badge bg-primary fs-5" data-controller="range-display" data-range-display-target="value">
                    {{ form.vars.value.numberOfPersonas|default(3) }} persona(s)
                </span>
            </div>

            {{ form_row(form.additionalContext, {
                label: 'Contexte additionnel (optionnel)',
                attr: {
                    class: 'form-control',
                    rows: '4',
                    placeholder: 'Exemple : Focus sur les décideurs techniques, entreprises 50-500 employés, budget IT >100k€'
                }
            }) }}

            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                <strong>L'IA va analyser :</strong>
                <ul class="mb-0 mt-2">
                    <li>Votre secteur : <strong>{{ project.sector }}</strong></li>
                    <li>Votre produit/service : <strong>{{ project.productInfo|u.truncate(60, '...') }}</strong></li>
                    <li>Votre objectif : <strong>{{ ('goal.type.' ~ project.goalType.value)|trans({}, 'marketing') }}</strong></li>
                    {% if project.websiteUrl %}
                        <li>Style de marque depuis votre site web</li>
                    {% endif %}
                </ul>
            </div>

            <div class="d-flex gap-2 justify-content-end mt-4">
                <a href="{{ path('marketing_project_show', {id: project.id}) }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Retour
                </a>
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-magic"></i> Lancer la génération IA
                </button>
            </div>

            {{ form_end(form) }}
        </div>
    </div>

    <div class="card border-warning">
        <div class="card-body">
            <h6 class="text-warning">
                <i class="bi bi-clock-history me-2"></i>
                Processus asynchrone
            </h6>
            <p class="mb-0 small">
                La génération s'effectue en arrière-plan avec Symfony Messenger.
                Vous serez notifié en temps réel via Mercure lorsque les personas seront prêts.
            </p>
        </div>
    </div>
</div>
{% endblock %}
