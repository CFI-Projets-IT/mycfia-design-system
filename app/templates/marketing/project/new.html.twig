{% extends 'layouts/home.html.twig' %}

{% block title %}Nouveau Projet Marketing - myCFiia{% endblock %}

{% block content_classes %} marketing-page{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="max-width: 1400px;">
    {# Breadcrumb Navigation #}
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="{{ path('marketing_project_index') }}" class="text-decoration-none">
                    <i class="bi bi-grid-3x3-gap"></i> Projets Marketing
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Nouveau projet</li>
        </ol>
    </nav>

    {# Page Header #}
    <div class="mb-4">
        <h1 class="h2 fw-bold mb-2">
            <i class="bi bi-plus-circle text-primary"></i>
            Créer un projet marketing
        </h1>
    </div>

    {# Flash Messages #}
    {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill"></i> {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    {# Barre de progression des étapes #}
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="fw-bold mb-0">
                    <i class="bi bi-list-check text-primary"></i>
                    Processus de création
                </h6>
                <span class="badge bg-primary">Étape 1 sur 4</span>
            </div>

            {# Barre de progression #}
            <div class="progress mb-4" style="height: 8px;">
                <div class="progress-bar bg-primary" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            {# Étapes en flex #}
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="d-flex align-items-start">
                        <div class="me-3">
                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                                1
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold text-primary">Informations projet</h6>
                            <p class="small text-muted mb-0">
                                Définissez le cadre de votre campagne
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="d-flex align-items-start">
                        <div class="me-3">
                            <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                                2
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold text-muted">Génération personas</h6>
                            <p class="small text-muted mb-0">
                                3-5 personas clients détaillés
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="d-flex align-items-start">
                        <div class="me-3">
                            <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                                3
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold text-muted">Stratégie marketing</h6>
                            <p class="small text-muted mb-0">
                                Répartition optimisée du budget
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="d-flex align-items-start">
                        <div class="me-3">
                            <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                                4
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold text-muted">Assets marketing</h6>
                            <p class="small text-muted mb-0">
                                Contenus multi-canaux
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Layout 2 colonnes : Formulaire + Sidebar #}
    <div class="row g-4">
        {# Colonne principale : Formulaire #}
        <div class="col-12 col-lg-8">
            {# Form Card #}
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    {{ form_start(form, {
                        attr: {
                            class: 'needs-validation',
                            novalidate: 'novalidate',
                            'data-turbo': 'false'
                        }
                    }) }}

                    {# Erreurs globales du formulaire #}
                    {{ form_errors(form) }}

                    {# Section 1: Informations projet et entreprise #}
                    <div class="mb-4">
                        <h5 class="fw-bold mb-3 pb-2 border-bottom">
                            <i class="bi bi-info-circle-fill text-primary"></i>
                            Informations projet et entreprise
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                {{ form_row(form.name, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        placeholder: 'Ex: Campagne Q4 2025 - Acquisition B2B'
                                    }
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.companyName, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        placeholder: 'Ex: TechCorp SAS'
                                    }
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.sector, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {class: 'form-select'}
                                }) }}
                            </div>
                        </div>
                    </div>

                    {# Section 2: Détails marketing #}
                    <div class="mb-4">
                        <h5 class="fw-bold mb-3 pb-2 border-bottom">
                            <i class="bi bi-bullseye text-success"></i>
                            Détails marketing
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                {{ form_row(form.description, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        rows: '4',
                                        placeholder: 'Objectif global de votre campagne...'
                                    }
                                }) }}
                            </div>

                            <div class="col-12">
                                {{ form_row(form.productInfo, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        rows: '4',
                                        placeholder: 'Caractéristiques, avantages, public cible...'
                                    }
                                }) }}
                            </div>
                        </div>
                    </div>

                    {# Section 3: Objectifs marketing #}
                    <div class="mb-4">
                        <h5 class="fw-bold mb-3 pb-2 border-bottom">
                            <i class="bi bi-bullseye text-warning"></i>
                            Objectifs marketing
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                {{ form_row(form.goalType, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {class: 'form-select'}
                                }) }}
                            </div>
                            <div class="col-12">
                                {{ form_row(form.detailedObjectives, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        rows: '5',
                                        placeholder: 'Ex: Générer 100 leads qualifiés/mois, réduire CAC de 20%, augmenter trafic site de 50%'
                                    }
                                }) }}
                            </div>
                        </div>
                    </div>

                    {# Section 4: Budget et Timeline #}
                    <div class="mb-4">
                        <h5 class="fw-bold mb-3 pb-2 border-bottom">
                            <i class="bi bi-currency-euro text-info"></i>
                            Budget et période de campagne
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-12">
                                {{ form_row(form.budget, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        placeholder: '5000.00'
                                    }
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.startDate, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {class: 'form-control'}
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.endDate, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {class: 'form-control'}
                                }) }}
                            </div>
                        </div>
                    </div>

                    {# Section 5: Informations complémentaires #}
                    <div class="mb-4">
                        <h5 class="fw-bold mb-3 pb-2 border-bottom">
                            <i class="bi bi-link-45deg text-secondary"></i>
                            Informations complémentaires
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                {{ form_row(form.websiteUrl, {
                                    label_attr: {class: 'form-label fw-semibold'},
                                    attr: {
                                        class: 'form-control',
                                        placeholder: 'https://www.example.com'
                                    }
                                }) }}
                            </div>
                        </div>
                    </div>

                    {# Section 6: Types d'assets marketing (v3.5.0) #}
                    <div class="mb-4">
                        <h5 class="fw-bold mb-3 pb-2 border-bottom">
                            <i class="bi bi-files text-info"></i>
                            Types d'assets marketing à générer
                        </h5>
                        <p class="text-muted small mb-3">
                            <i class="bi bi-info-circle"></i>
                            Sélectionnez les canaux pour lesquels générer des contenus marketing. Si aucun n'est sélectionné, tous seront générés.
                        </p>

                        {# Grille de cartes pour les checkboxes #}
                        <div class="row g-3">
                            {% for child in form.selectedAssetTypes %}
                                <div class="col-md-6 col-lg-3">
                                    <div class="card h-100 border asset-type-card">
                                        <label class="card-body d-flex align-items-center justify-content-between p-3 cursor-pointer" for="{{ child.vars.id }}">
                                            <div class="d-flex align-items-center gap-2">
                                                <i class="bi bi-{% if 'linkedin' in child.vars.value %}linkedin{% elseif 'google' in child.vars.value or 'bing' in child.vars.value %}megaphone{% elseif 'facebook' in child.vars.value %}facebook{% elseif 'instagram' in child.vars.value %}instagram{% elseif 'mail' in child.vars.value %}envelope{% elseif 'iab' in child.vars.value %}badge-ad{% else %}file-text{% endif %} text-primary fs-4"></i>
                                                <span class="fw-semibold">{{ child.vars.label }}</span>
                                            </div>
                                            {{ form_widget(child, {
                                                attr: {class: 'form-check-input asset-type-checkbox'}
                                            }) }}
                                        </label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    {# Form Actions #}
                    <div class="d-flex gap-2 justify-content-between mt-4 pt-4 border-top">
                        <a href="{{ path('marketing_project_index') }}" class="btn btn-outline-secondary px-4">
                            <i class="bi bi-x-circle"></i> Annuler
                        </a>
                        {{ form_widget(form.analyze, {
                            attr: {
                                class: 'btn btn-primary px-4'
                            }
                        }) }}
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>

        {# Colonne sidebar : Guide et prochaines étapes #}
        <div class="col-12 col-lg-4">
            {# Guide contextuel #}
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">
                        <i class="bi bi-lightbulb"></i>
                        Guide de remplissage
                    </h6>
                </div>
                <div class="card-body">
                    {# Nom du projet #}
                    <div class="mb-3 pb-3 border-bottom">
                        <h6 class="fw-bold text-primary mb-2">
                            <i class="bi bi-tag-fill"></i> Nom du projet
                        </h6>
                        <p class="small text-muted mb-0">
                            Choisissez un nom explicite qui identifie clairement votre campagne.
                            <strong>Exemple</strong> : "Lancement Produit Q2 2025" ou "Acquisition B2B Tech".
                        </p>
                    </div>

                    {# Description et Produit #}
                    <div class="mb-3 pb-3 border-bottom">
                        <h6 class="fw-bold text-success mb-2">
                            <i class="bi bi-card-text"></i> Description & Produit
                        </h6>
                        <p class="small text-muted mb-0">
                            La <strong>description</strong> doit expliquer l'objectif global de votre campagne.
                            Les <strong>informations produit</strong> détaillent ce que vous vendez, ses avantages et votre audience cible.
                        </p>
                    </div>

                    {# Objectifs SMART #}
                    <div class="mb-3 pb-3 border-bottom">
                        <h6 class="fw-bold text-warning mb-2">
                            <i class="bi bi-bullseye"></i> Objectifs SMART
                        </h6>
                        <p class="small text-muted mb-2">
                            Définissez des objectifs <strong>mesurables et chiffrés</strong> :
                        </p>
                        <ul class="small text-muted mb-0 ps-3">
                            <li><strong>S</strong>pécifiques : "Générer 100 leads qualifiés"</li>
                            <li><strong>M</strong>esurables : Avec des KPIs précis</li>
                            <li><strong>A</strong>tteignables : Réalistes avec vos ressources</li>
                            <li><strong>R</strong>elevants : Alignés avec vos priorités</li>
                            <li><strong>T</strong>emporels : "d'ici 3 mois"</li>
                        </ul>
                    </div>

                    {# Budget & Timeline #}
                    <div class="mb-3 pb-3 border-bottom">
                        <h6 class="fw-bold text-info mb-2">
                            <i class="bi bi-currency-euro"></i> Budget & Période
                        </h6>
                        <p class="small text-muted mb-1">
                            <strong>Budget</strong> : Montant total alloué à la campagne (minimum recommandé : 2000€).
                        </p>
                        <p class="small text-muted mb-0">
                            <strong>Période</strong> : Durée optimale de <strong>30 à 90 jours</strong> pour tester et ajuster votre stratégie.
                        </p>
                    </div>

                    {# Site web & Analyse IA #}
                    <div class="mb-0">
                        <h6 class="fw-bold text-secondary mb-2">
                            <i class="bi bi-link-45deg"></i> Site web & IA
                        </h6>
                        <p class="small text-muted mb-2">
                            L'<strong>URL de votre site</strong> permet à l'IA d'analyser votre positionnement et ton de communication.
                        </p>
                        <p class="small text-muted mb-0">
                            <i class="bi bi-robot"></i> Utilisez <strong>"Analyser et améliorer avec l'IA"</strong> pour obtenir :
                            recommandations budget, objectifs reformulés, warnings de cohérence.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
