{% extends 'layouts/home.html.twig' %}

{% block title %}Chat IA - myCFiia{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/components/chat-nav-tabs.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/components/chat-messages.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/components/chat-input.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/components/data-table.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/chat.css') }}">
{% endblock %}

{% block navigation %}
{# Navigation Tabs - Positionn√©e juste apr√®s le header, avant le contenu #}
{{ component('ChatNavTabs', { context: context }) }}
{% endblock %}

{% block content_classes %} chat-page{% endblock %}

{% block content %}
{# ==================================================================================
   NOUVELLE UI IMMERSIVE CHAT - EN D√âVELOPPEMENT

   ‚ö†Ô∏è IDs JavaScript REQUIS pour chat.js (NE PAS SUPPRIMER) :
   - #chatForm           ‚Üí Formulaire de soumission
   - #chatInput          ‚Üí Textarea de saisie
   - #chatMessages       ‚Üí Conteneur des messages
   - #sendButton         ‚Üí Bouton d'envoi
   - #charCount          ‚Üí Compteur de caract√®res
   - #chatLoading        ‚Üí Indicateur de chargement
   - #clearChat          ‚Üí Bouton nouvelle conversation
   - #exportChat         ‚Üí Bouton export
   - .quick-question     ‚Üí Boutons suggestions (class)

   üìã Variables Twig disponibles :
   - context             ‚Üí Type de chat (factures|commandes|stocks|general)
   - conversationId      ‚Üí UUID de la conversation
   - mercureUrl          ‚Üí URL du hub Mercure
   - mercureJwt          ‚Üí Token JWT pour Mercure
   - app.user.fullName   ‚Üí Nom complet de l'utilisateur
   ================================================================================== #}

{# Zone des messages - Vide au d√©marrage, messages ajout√©s dynamiquement par chat.js #}
<div id="chatMessages" class="chat-messages-container">
    {# Les messages seront ins√©r√©s ici dynamiquement via JavaScript #}
</div>

{# ==================================================================================
   DONN√âES JAVASCRIPT - ABSOLUMENT CRITIQUE - NE JAMAIS SUPPRIMER
   Ce div invisible injecte la configuration dans chat.js via data attributes
   ================================================================================== #}
<div id="chatData"
     data-context="{{ context }}"
     data-conversation-id="{{ conversationId }}"
     data-mercure-url="{{ mercureUrl }}"
     data-mercure-jwt="{{ mercureJwt }}"
     data-message-url="{{ path('chat_message', {context: context}) }}"
     data-stream-url="{{ path('chat_stream', {context: context}) }}"
     data-assistant-logo="{{ asset('images/assistant-picto.svg') }}"
     style="display: none;">
</div>
{% endblock %}

{% block sticky_bottom %}
{# CONTAINER 3 : Input fixe en bas #}
<div class="sticky-bottom-container">
    {{ component('ChatInput', { context: context }) }}
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="module" src="{{ asset('js/chat.js') }}"></script>
{% endblock %}
