[program:messenger-worker]
; Commande à exécuter (chemin absolu)
command=php /var/www/html/bin/console messenger:consume async --time-limit=3600 --memory-limit=128M --sleep=1 -vv
; Répertoire de travail
directory=/var/www/html
; Utilisateur d'exécution (www-data = UID 82 en prod, ajusté dynamiquement en dev)
user=www-data
; Nombre de processus workers (ajustable selon charge)
numprocs=1
; Démarrage automatique au lancement de Supervisor
autostart=true
; Redémarrage automatique en cas d'arrêt inattendu
autorestart=true
; Délai de stabilité avant considérer le processus comme "démarré"
startsecs=5
; Nombre de tentatives de redémarrage avant abandon
startretries=10
; Stratégie de redémarrage : unexpected = seulement si crash (pas si arrêt normal)
autorestart=unexpected
; Codes de sortie considérés comme "attendus" (sortie propre)
exitcodes=0,2
; Signal d'arrêt : SIGTERM pour arrêt propre
stopsignal=TERM
; Temps d'attente avant SIGKILL après SIGTERM
stopwaitsecs=30
; Capture des logs stdout
stdout_logfile=/var/www/html/var/log/messenger/worker-%(process_num)02d.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
; Capture des logs stderr
stderr_logfile=/var/www/html/var/log/messenger/worker-%(process_num)02d-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
; Variables d'environnement (héritées du système)
environment=APP_ENV="%(ENV_APP_ENV)s"
; Priorité de démarrage (999 = démarre après les autres services)
priority=999
